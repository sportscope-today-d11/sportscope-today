{% extends "auth.html" %}

{% block title %}
<h2 class="text-3xl font-bold text-gray-900 brand-text mb-2">Login to Your Account</h2>
<p class="text-gray-600 text-base font-inter">Stay updated with the latest sports news</p>
{% endblock %}

{% block content %}
<form id="ajax-login-form" class="space-y-5">
  {% csrf_token %}

  <div>
    <label class="block text-sm font-semibold text-gray-700 mb-2">Username<span class="text-red-500">*</span></label>
    <input id="username" type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 outline-none transition-all"
      placeholder="Enter your username" required>
  </div>

  <div>
    <label class="block text-sm font-semibold text-gray-700 mb-2">Password<span class="text-red-500">*</span></label>
    <input id="password" type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 outline-none transition-all"
      placeholder="Enter your password" required>
  </div>

  <div id="login-error" class="hidden text-red-600 text-sm font-medium"></div>

  <button id="ajax-login-btn" type="button"
    class="w-full text-white py-3.5 rounded-xl font-semibold transition-all duration-300 text-base shadow-lg hover:shadow-xl active:scale-[0.98] relative flex justify-center"
    style="background: linear-gradient(135deg, #0a2463 0%, #1e3a8a 100%);">
    <span class="btn-text">Login</span>
    <svg class="loader hidden animate-spin w-5 h-5 text-white absolute"
      fill="none" viewBox="0 0 24 24">
      <circle class="opacity-30" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-90" fill="currentColor"
        d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>
  </button>
</form>

<div class="mt-8 text-center">
  <div class="relative">
    <div class="absolute inset-0 flex items-center">
      <div class="w-full border-t border-gray-300"></div>
    </div>
    <div class="relative flex justify-center text-sm">
      <span class="px-4 bg-white text-gray-500 font-medium">New to Sportscope Today?</span>
    </div>
  </div>

  <p class="text-sm text-gray-600 mt-6">
    <a href="{% url 'main:register' %}"
       class="inline-flex items-center gap-2 font-semibold hover:underline transition-colors px-4 py-2 rounded-lg hover:bg-gray-50"
       style="color: #0a2463;">
      <span>Create an account</span>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
      </svg>
    </a>
  </p>
</div>

<script>
const form = document.getElementById("ajax-login-form");
form.addEventListener("submit", e => e.preventDefault()); // HENTIKAN GET âœ…

document.getElementById("ajax-login-btn").addEventListener("click", function () {

    const errorBox = document.getElementById("login-error");
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value;
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    errorBox.classList.add("hidden");

    fetch("{% url 'main:login' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": csrftoken,
            "Content-Type": "application/json",
        },
        body: JSON.stringify({username, password}),
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            window.location.href = data.redirect_url;
        } else {
            errorBox.innerText = data.message;
            errorBox.classList.remove("hidden");
        }
    })
    .catch(() => {
        errorBox.innerText = "Network error";
        errorBox.classList.remove("hidden");
    });
});
</script>



{% endblock %}
